---
layout: ../layouts/Layout.astro
title: Recipe
description: Make your Astro project an installable PWA with offline-support
type: recipe
stub: true
service: Vite-PWA
i18nReady: false
---

# Recipe

A PWA is just any web app that provides a webmanifest and a service worker (for offline support).

[Vite-PWA](https://vite-pwa-org.netlify.app/) is an open-source PWA integration for Vite, that offers functionality to generate and link to the webmanifest and to generate and register the service worker. It provides an [integration for Astro](https://vite-pwa-org.netlify.app/frameworks/astro.html) that understands the Astro project structure and can incorporate it into the manifest(s).

## Step-by-step

### Install Vite-PWA

Install the Vite-PWA Astro integration as development dependency

```bash
pnpm add -D @vite-pwa/astro workbox-window
```

### Generate assets (optional)

If you have all required PNG and ICO assets for your branding, you can skip this step.

Vite-PWA provides an asset generator, that takes your favicon.svg and generates all required formats to be included in your webmanifest.

Install the asset generator

```bash
pnpm add -D @vite-pwa/assets-generator
```

Add the following to the `scripts` of `package.json`

```json
    "generate-pwa-assets": "pwa-assets-generator --preset minimal public/favicon.svg",
```

Run the asset generator

```bash
pnpm generate-pwa-assets
```

The generated artifacts should either be added to your repository or you need to integrate the asset generation in your build process.

### Create custom part of webmanifest

Create a JSON file `webmanifest.json` at the root of your project with the following content

```json
{
  "$schema": "https://json.schemastore.org/web-manifest-combined.json",
  "id": "astro-pwa-recipe",
  "name": "Astro PWA | The recipe",
  "short_name": "Astro PWA",
  "description": "Example PWA for Astro using Vite-PWA",
  "theme_color": "#ff5d01",
  "background_color": "#11191f",
  "icons": [
    {
      "src": "pwa-64x64.png",
      "sizes": "64x64",
      "type": "image/png"
    },
    {
      "src": "pwa-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "pwa-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "maskable-icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable"
    }
  ]
}
```

These are custom settings, that will be injected into the generated webmanifest, others are configured in the integration. Adapt the settings, e.g. the colors, to your app.

### Configure the Astro integration

Update `astro.config.mjs` to include the AstroPWA integration

```js
import { defineConfig } from "astro/config";
import AstroPWA from "@vite-pwa/astro";
import manifest from "./webmanifest.json";

// https://astro.build/config
export default defineConfig({
  integrations: [
    AstroPWA({
      mode: "production",
      registerType: "autoUpdate",
      includeAssets: ["favicon.svg"],
      workbox: {
        navigateFallback: "/",
        globPatterns: ["**/*.{css,js,html,svg,png,ico,txt}"],
      },
      experimental: {
        directoryAndTrailingSlashHandler: true,
      },
      manifest,
    }),
  ],
});
```

This configures the PWA in production mode with automatic updates. The [underlying workbox is configured](https://vite-pwa-org.netlify.app/workbox/) for all generated file types.

### Register the service worker

Add a script to your base layout (or all layouts if you don't use a central layout), that registers the service worker on every page of the app.

```ts
  <script>
    import { registerSW } from "virtual:pwa-register";

    registerSW({
      immediate: true,
      onRegisteredSW(swScriptUrl) {
        console.log("SW registered: ", swScriptUrl);
      },
      onOfflineReady() {
        console.log("PWA application ready to work offline");
      },
    });
  </script>
```

This uses a Vite-PWA virtual module. To make this available to Typescript you must expicitly install the basic Vite-PWA (at least for pnpm). That still does not work in Astro files, though.

```
pnpm add -D vite-plugin-pwa
```

and add the triple-slash type references to `src/env.d.ts`

```ts
/// <reference types="vite-plugin-pwa/info" />
/// <reference types="vite-plugin-pwa/vanillajs" />
```

## Community Resources

- Shaun Chander's [Astro PWA Starter](https://github.com/shaunchander/astro-pwa-starter/tree/master), uses a slightly outdated version of the Vite-PWA Plugin, that does not have the Astro integration yet

## Production Sites

The following sites use Vite-PWA + Astro in production:

- [yunielacosta.com](https://www.yunielacosta.com/) by Yuniel Acosta â€” [source code on GitHub](https://github.com/yacosta738/yacosta738.github.io) (Netlify CMS)
- The [Elk Mastodon App](https://docs.elk.zone/pwa) usesVite-PWA with Vue and not Astro, but it demonstrates a lot of the PWA features incorporated into Vite-PWA (and workbox).
